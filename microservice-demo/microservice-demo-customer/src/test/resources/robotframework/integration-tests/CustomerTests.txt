*** Settings ***
Library         OperatingSystem
Library         Collections
Library         String
Library         RequestsLibrary

Suite Setup     Initialize Session
Suite Teardown  Close All Sessions

*** Variables ***
${SERVICE_URL}          http://localhost:8080

*** Test Cases ***
List customer info from database
  Given Customer exists at the database
  When I get the customer through REST API
  Then customer name should be "Wolff"
   and firstname should be "Eberhard"
   and email should be "eberhard.wolff@gmail.com"
   and strees should be "Unter den Linden"
   and city should be "Berlin"
  
 *** Keywords ***

Get JSON Form  [Arguments]  ${form}
  [Documentation]  Reads the json template. Template name is given as an argument. 
  ...              Template should reside at the same directory as the test case. 
  ${json}=  Get File  ${CURDIR}${/}${form}  encoding=utf-8
  Set Test Variable  ${FORM}  ${json}

Initialize Session
  [Documentation]  Creates context for REST API calls. 
  ${headers}=  Create Dictionary  Content-type=application/json  Accept=*/*  Accept-language=en-US,en;fi  Cache-control=no-cache
  Set Suite Variable  ${HEADERS}  ${headers}
  Create Session  appsrv  ${SERVICE_URL}  headers=${headers}  

I get the Customer through REST API  [Arguments]  ${cust_id}=1  
  [Documentation]  
  ${result}=  Get JSON data  /customer/customer  ${cust_id}
  Set Test Variable  ${JSON_CUSTOMER}  ${result}

I Add The Customer Through REST API
  ${data}=  Replace Variables  ${FORM}
  ${result}=  Post JSON data  /customer/customer  ${data}
 

Get JSON data  [Arguments]   ${uri}  ${cust_id}
  [Documentation]  Reads the data as JSON object through REST API. The service URI is given as an argument.
  ...              Customer id is given as second argument
  ...              Returns also the received JSON object
  ${resp}=  Get Request  appsrv  ${uri}/${cust_id}
  Should Be Equal As Strings  ${resp.status_code}  200
  ${actual}=  To Json  ${resp.content}
  Log  ${resp.content}
  [Return]  ${actual}

Post JSON data  [Arguments]  ${uri}  ${data}
  [Documentation]  Posts Customer data through REST API.
  Log  ${data}
  ${resp}=  Post Request  appsrv  ${uri}  data=${data}
  Log  ${resp.text}
  Should Be Equal As Strings  ${resp.status_code}  201
  ${actual}=  To Json  ${resp.content}
  Log  ${actual}
  [Return]  ${actual} 

Customer exists at the database
    Log       "Huhuu"   
#TBD

Customer name should be "${name}"
  Should Be Equal As Strings  ${JSON_CUSTOMER['name']}  ${name}

Firstname should be "${lastname}"
    Should Be Equal As Strings  ${JSON_CUSTOMER['lastname']}  ${lastname}

Email should be "${email}"
    Should Be Equal As Strings  ${JSON_CUSTOMER['email']}  ${email}

Street should be "${street}"
    Should Be Equal As Strings  ${JSON_CUSTOMER['street']}  ${street}

City should be "${city}"
    Should Be Equal As Strings  ${JSON_CUSTOMER['city']}  ${city}

Close all sessions
    Log         "Close all"
    