*** Settings ***
Library                 Collections
Library                 String
Library                 Selenium2Library    10.0  1.0      #timeout, implicit_wait
Library                 OperatingSystem
Resource                variables.txt
Suite Setup             Setup Connections and Environment
#Suite Teardown          Delete Connections and stop Environment
#Test Teardown           General Test Teardown


*** Test Cases ***
Microservice-demo Add New Customer and Remove It
    [Documentation]
    [Tags]  REGRESSION
#    Given Andon Engine Is Connected to Go Server
    Given Microservice-demo Customer View is Accessible
    When New Customer is Created
    Then I can verify Newly Added Customer and then Remove it

Microservice-demo Add an Item to Catalog and Remove It
     [Tags]     REGRESSION
     #    Given Andon Engine Is Connected to Go Server
    Given Microservice-demo Catalog List View is Accessible
    Given Microservice-demo Catalog Search View is Accessible
    #Then I Can Add a New Item "Sony Walkman TPS-L2" Costing "300" in Catalog and Remove It

Microservice-demo Add an Order and Remove It
    [Tags]     REGRESSION
    #    Given Andon Engine Is Connected to Go Server
    Given Microservice-demo Order View is Accessible
    #Then I Can Add a New Order  "New Order" and Remove It

*** Keywords ***
Microservice-demo Customer View is Accessible
	Navigate Customer View

Microservice-demo Catalog List View is Accessible
        Run Keyword And Ignore Error  Click Link  Home
        Wait Until Element Is Visible       ${LIST_ITEMS_CATALOG_LINK}     timeout=20 seconds
        Click Element      ${LIST_ITEMS_CATALOG_LINK} 
        Wait Until Page Contains      Item : View all       timeout=20 seconds
        Click Link          Home
        Wait Until Page Contains        Order Processing        timeout=20 seconds

Microservice-demo Catalog Search View is Accessible
        Run Keyword And Ignore Error  Click Link  Home
        Wait Until Element Is Visible       ${SEARCH_ITEMS_CATALOG_LINK}     timeout=20 seconds
        Click Element      ${SEARCH_ITEMS_CATALOG_LINK} 
        Wait Until Page Contains      Search for Item by Name       timeout=20 seconds
        Go Back
        Wait Until Page Contains        Order Processing        timeout=20 seconds

Microservice-demo Order View is Accessible
        Run Keyword And Ignore Error  Click Link  Home
        Click Link         Order
        Wait Until Page Contains        Order : View all        timeout=20 seconds
        Click Link          Home
        Wait Until Page Contains        Order Processing        timeout=20 seconds
        
I Can Add a New Item "${item}" Costing "${price}" in Catalog and Remove It
        Add Item "${item}" Costing "${price}" in Catalog
        Delete Item "${item}" from Catalog
        Verify Item "${item}" Does Not Exist

Add Item "${item}" Costing "${price}" in Catalog
        Wait Until Element Is Visible       ${LIST_ITEMS_CATALOG_LINK}     timeout=20 seconds
        Click Element      ${LIST_ITEMS_CATALOG_LINK} 
        Wait Until Page Contains      Item : View all       timeout=20 seconds
        Wait Until Page Contains           Add Item     timeout=20 seconds
        Click Link     Add Item
        Wait Until Element Is Visible      id=name    timeout=20 seconds
        Input Text      id=name    ${item}  
        Input Text      id=price   ${price}   
        Click Button      Submit
        Wait Until Page Contains       Success      timeout=20 seconds     
        Click Link          Home

Delete Item "${item}" from Catalog
        Wait Until Element Is Visible       ${SEARCH_ITEMS_CATALOG_LINK}     timeout=20 seconds
        Click Element      ${SEARCH_ITEMS_CATALOG_LINK} 
        Wait Until Element Is Visible      ${SEARCH_ITEMS_FIELD}       timeout=20 seconds
        Input Text      ${SEARCH_ITEMS_FIELD}      ${item}
        Click Button        Submit
        Wait Until Page Contains        ${item}        timeout=20 seconds  
        #Click Button       delete
        #Wait Until Page Contains       Success        timeout=20 seconds
        #Click Link          Home

Verify Item "${item}" Does Not Exist
        Wait Until Element Is Visible       ${SEARCH_ITEMS_CATALOG_LINK}     timeout=20 seconds
        Click Element      ${SEARCH_ITEMS_CATALOG_LINK} 
        Wait Until Element Is Visible      ${SEARCH_ITEMS_FIELD}       timeout=20 seconds
        Input Text      ${SEARCH_ITEMS_FIELD}      ${item}
        Click Button        Submit
        Wait Until Page Contains     No items       timeout=20 seconds  
        Click Link          Home

I Can Add a New Order "${order}" and Remove It
        Wait Until Page Contains          Order      timeout=20 seconds
        #TBD
        
Navigate Customer View
	Run Keyword And Ignore Error  Click Link  Home
	Wait Until Keyword Succeeds  ${MAX_WAIT_TIME}  20s     Click Link  Customer
	Go Back
	Wait Until Keyword Succeeds  ${MAX_WAIT_TIME}  20s     Click Link  Customer
	Wait Until Keyword Succeeds  ${MAX_WAIT_TIME}  20s     Page Should Contain  Customer : View all

New Customer is Created
	Click Link  Add Customer
	Fill Values to Customer Form
	Run Keyword If    ${DEBUG LEVEL}==1    Capture Page Screenshot    
	Click Button  Submit
	Page Should Contain  Success

Fill Values to Customer Form
	Input Text  name  Robot
	Input Text  firstname  Framework
	Input Text  email  rorbot.framework@tieto.com
	Input Text  street  Hvt
	Input Text  city  Tampere
	
I can verify Newly Added Customer and then Remove it
	Navigate Customer View
	Run Keyword If    ${DEBUG LEVEL}==1    Capture Page Screenshot    
	Page Should Contain  Robot
	Page Should Contain  Framework
	Click Button  //td[text()="Robot"]/..//input[@value="delete" and @type="submit"]
	Page Should Contain  Success

Microservice-demo Should Be Accessible
    Wait Until Keyword Succeeds  ${MAX_WAIT_TIME}  10s     Microservice-demo Front Page Should Be loaded

Microservice-demo Front Page Should Be loaded
    Open Browser  ${SUT}  ${BROWSER}  ${EMPTY}  ${SELENIUM_GRID_URL}
    Wait Until Page Contains  Order Processing

Setup Connections and Environment
	Microservice-demo Should Be Accessible
