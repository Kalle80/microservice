acceptance_testing:
  dependency:
   - Catalog [CompileAndUnitTests]
   - Customer [CompileAndUnitTests]
   - Order [CompileAndUnitTests]
   - Zuul [CompileAndUnitTests]
  compose_file_path: /src/test/resources
  compose_file_name: docker-compose.yml
  go_cd_agent_props:
    - java:8
    - maven
  
#  cron_timer: 0 0 22 ? * MON-FRI
  post_stage:
    custom_cmd:
      - sudo docker login -u eekamak -p $passu
      - sudo docker tag catalog:$GO_REVISION_CATALOG eekamak/catalog:$GO_REVISION_CATALOG
      - sudo docker push eekamak/catalog:$GO_REVISION_CATALOG
      - sudo docker tag customer:$GO_REVISION_CUSTOMER eekamak/customer:$GO_REVISION_CUSTOMER
      - sudo docker push eekamak/customer:$GO_REVISION_CUSTOMER
      - sudo docker tag order:$GO_REVISION_ORDER eekamak/order:$GO_REVISION_ORDER
      - sudo docker push eekamak/order:$GO_REVISION_ORDER
      - sudo docker tag eureka:$GO_REVISION_EUREKA eekamak/eureka:$GO_REVISION_EUREKA
      - sudo docker push eekamak/eureka:$GO_REVISION_EUREKA
      - sudo docker tag zuul:$GO_REVISION_ZUUL eekamak/zuul:$GO_REVISION_ZUUL
      - sudo docker push eekamak/zuul:$GO_REVISION_ZUUL

  tests:
    - test_commands:
      - mvn clean -P robot -D robot.browser=chrome -D robot.remote_url=http://hub:4444/wd/hub -D robot.order.url=http://zuul:8080/order/ -D robot.main.url=http://zuul:8080 -D robot.catalog_rest_url=http://catalog:8080 -D robot.customer_rest_url=http://customer:8080 clean install
#      - mvn clean -P robot -D robot.browser=chrome -D robot.remote_url=http://hub:4444/wd/hub -D robot.url=http://zuul:8080/order/ -D robot.catalog_rest_url=http://catalog:8080 -D robot.customer_rest_url=http://customer:8080 clean install
#      - mvn -P robot -D variable.robot=SUT_HOST:zuul,SUT_PORT:8080,BROWSER=firefox org.robotframework:robotframework-maven-plugin:run
      type: parallel
      test_services:
        selenium_grid: true
#        service_virtualization: true
#    - test_commands:
#      - true
#      - true
#      - true
#      type: serial
#      test_services:
#        selenium_grid: true
#        service_virtualization: false
    
  selenium_grid_browsers:
    - name: chrome
      amount: 1
      version: "latest"
    - name: firefox
      amount: 1
      version: "latest"

#  service_virtualization:
#    mari_file_path: src/test/resources/service-virtualization/VirtualServices
#    mari_file_names:
#      - bookapprest.mari


